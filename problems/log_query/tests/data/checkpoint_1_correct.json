{
  "01_basic_projection": {
    "case": {
      "arguments": "--log-file logs.ndjson --query 'SELECT level, message FROM logs'",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "level": "INFO",
              "message": "ok",
              "status": 200,
              "http": {
                "status": 200
              }
            },
            {
              "level": "ERROR",
              "message": "boom",
              "status": "500",
              "service": "api",
              "http": {
                "status": 500
              }
            },
            {
              "level": "WARN",
              "status": 503,
              "service": "worker",
              "http": {
                "status": 503
              }
            },
            {
              "level": "INFO",
              "service": "api",
              "http": {
                "status": "404"
              }
            },
            {
              "level": "INFO",
              "message": null,
              "service": "web",
              "meta": {
                "tags": [
                  "a",
                  "b"
                ]
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "level": "INFO",
          "message": "ok"
        },
        {
          "level": "ERROR",
          "message": "boom"
        },
        {
          "level": "WARN",
          "message": null
        },
        {
          "level": "INFO",
          "message": null
        },
        {
          "level": "INFO",
          "message": null
        }
      ],
      "status_code": 0
    }
  },
  "02_select_star_numeric_filter": {
    "case": {
      "arguments": "--log-file logs.ndjson --query 'SELECT * FROM logs WHERE http.status >= 500'",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "level": "INFO",
              "message": "ok",
              "status": 200,
              "http": {
                "status": 200
              }
            },
            {
              "level": "ERROR",
              "message": "boom",
              "status": "500",
              "service": "api",
              "http": {
                "status": 500
              }
            },
            {
              "level": "WARN",
              "status": 503,
              "service": "worker",
              "http": {
                "status": 503
              }
            },
            {
              "level": "INFO",
              "service": "api",
              "http": {
                "status": "404"
              }
            },
            {
              "level": "INFO",
              "message": null,
              "service": "web",
              "meta": {
                "tags": [
                  "a",
                  "b"
                ]
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "level": "ERROR",
          "message": "boom",
          "status": "500",
          "service": "api",
          "http": {
            "status": 500
          }
        },
        {
          "level": "WARN",
          "status": 503,
          "service": "worker",
          "http": {
            "status": 503
          }
        }
      ],
      "status_code": 0
    }
  },
  "03_or_and_precedence": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT level FROM logs WHERE level = \\\"ERROR\\\" OR level = \\\"WARN\\\" AND service = \\\"worker\\\"\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "level": "INFO",
              "message": "ok",
              "status": 200,
              "http": {
                "status": 200
              }
            },
            {
              "level": "ERROR",
              "message": "boom",
              "status": "500",
              "service": "api",
              "http": {
                "status": 500
              }
            },
            {
              "level": "WARN",
              "status": 503,
              "service": "worker",
              "http": {
                "status": 503
              }
            },
            {
              "level": "INFO",
              "service": "api",
              "http": {
                "status": "404"
              }
            },
            {
              "level": "INFO",
              "message": null,
              "service": "web",
              "meta": {
                "tags": [
                  "a",
                  "b"
                ]
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "level": "ERROR"
        },
        {
          "level": "WARN"
        }
      ],
      "status_code": 0
    }
  },
  "04_parentheses_precedence": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT level FROM logs WHERE (level = \\\"ERROR\\\" OR level = \\\"WARN\\\") AND service = \\\"api\\\"\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "level": "INFO",
              "message": "ok",
              "status": 200,
              "http": {
                "status": 200
              }
            },
            {
              "level": "ERROR",
              "message": "boom",
              "status": "500",
              "service": "api",
              "http": {
                "status": 500
              }
            },
            {
              "level": "WARN",
              "status": 503,
              "service": "worker",
              "http": {
                "status": 503
              }
            },
            {
              "level": "INFO",
              "service": "api",
              "http": {
                "status": "404"
              }
            },
            {
              "level": "INFO",
              "message": null,
              "service": "web",
              "meta": {
                "tags": [
                  "a",
                  "b"
                ]
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "level": "ERROR"
        }
      ],
      "status_code": 0
    }
  },
  "05_null_equality": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT service FROM logs WHERE message = null\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "level": "INFO",
              "message": "ok",
              "status": 200,
              "http": {
                "status": 200
              }
            },
            {
              "level": "ERROR",
              "message": "boom",
              "status": "500",
              "service": "api",
              "http": {
                "status": 500
              }
            },
            {
              "level": "WARN",
              "status": 503,
              "service": "worker",
              "http": {
                "status": 503
              }
            },
            {
              "level": "INFO",
              "service": "api",
              "http": {
                "status": "404"
              }
            },
            {
              "level": "INFO",
              "message": null,
              "service": "web",
              "meta": {
                "tags": [
                  "a",
                  "b"
                ]
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "service": "worker"
        },
        {
          "service": "api"
        },
        {
          "service": "web"
        }
      ],
      "status_code": 0
    }
  },
  "06_string_ordering_type_mismatch": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT status FROM logs WHERE status < \\\"300\\\"\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "level": "INFO",
              "message": "ok",
              "status": 200,
              "http": {
                "status": 200
              }
            },
            {
              "level": "ERROR",
              "message": "boom",
              "status": "500",
              "service": "api",
              "http": {
                "status": 500
              }
            },
            {
              "level": "WARN",
              "status": 503,
              "service": "worker",
              "http": {
                "status": 503
              }
            },
            {
              "level": "INFO",
              "service": "api",
              "http": {
                "status": "404"
              }
            },
            {
              "level": "INFO",
              "message": null,
              "service": "web",
              "meta": {
                "tags": [
                  "a",
                  "b"
                ]
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [],
      "status_code": 0
    }
  },
  "07_dotted_selection_with_nulls": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT http.status, meta.tags FROM logs WHERE level = \\\"INFO\\\"\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "level": "INFO",
              "message": "ok",
              "status": 200,
              "http": {
                "status": 200
              }
            },
            {
              "level": "ERROR",
              "message": "boom",
              "status": "500",
              "service": "api",
              "http": {
                "status": 500
              }
            },
            {
              "level": "WARN",
              "status": 503,
              "service": "worker",
              "http": {
                "status": 503
              }
            },
            {
              "level": "INFO",
              "service": "api",
              "http": {
                "status": "404"
              }
            },
            {
              "level": "INFO",
              "message": null,
              "service": "web",
              "meta": {
                "tags": [
                  "a",
                  "b"
                ]
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "http.status": 200,
          "meta.tags": null
        },
        {
          "http.status": "404",
          "meta.tags": null
        },
        {
          "http.status": null,
          "meta.tags": [
            "a",
            "b"
          ]
        }
      ],
      "status_code": 0
    }
  },
  "08_escaped_quotes": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT msg FROM logs WHERE msg = \\\"she said \\\\\\\"hi\\\\\\\"\\\"\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "msg": "she said \"hi\"",
              "level": "INFO"
            },
            {
              "msg": "she said \\hi",
              "level": "INFO"
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "msg": "she said \"hi\""
        }
      ],
      "status_code": 0
    }
  },
  "09_numbers_negatives_decimals": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT v FROM logs WHERE v <= 0.5\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "v": -1
            },
            {
              "v": 0.5
            },
            {
              "v": "0.5"
            },
            {
              "v": 2
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "v": -1
        },
        {
          "v": 0.5
        }
      ],
      "status_code": 0
    }
  },
  "10_complex_boolean_nested": {
    "case": {
      "arguments": "--log-file logs.ndjson --query \"SELECT a,b,c FROM logs WHERE (a = 1 AND (b = 2 OR b = 3)) OR (a = 2 AND c = 3)\"",
      "input_files": [
        {
          "path": "logs.ndjson",
          "content": [
            {
              "a": 1,
              "b": 2,
              "c": 3
            },
            {
              "a": 1,
              "b": 3,
              "c": 1
            },
            {
              "a": 2,
              "b": 2,
              "c": 2
            },
            {
              "a": 2,
              "b": 3,
              "c": 3
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "output": [
        {
          "a": 1,
          "b": 2,
          "c": 3
        },
        {
          "a": 1,
          "b": 3,
          "c": 1
        },
        {
          "a": 2,
          "b": 3,
          "c": 3
        }
      ],
      "status_code": 0
    }
  }
}