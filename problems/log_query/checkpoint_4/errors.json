{
  "01_strict_conflict_detection": {
    "case": {
      "arguments": "--source a=a.ndjson --query \"SELECT a.id, CANON.route FROM a GLOSS STRICT { route := a.route | a.path }\"",
      "input_files": [
        {
          "path": "a.ndjson",
          "content": [
            {
              "id": 10,
              "route": "/a"
            },
            {
              "id": 11,
              "route": "/a",
              "path": "/b"
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "stderr": {
        "error": ".*E_RUNTIME.*",
        "code": "E_RUNTIME"
      },
      "status_code": 1
    }
  },
  "02_non_anchor_in_where": {
    "case": {
      "arguments": "--source a=a.ndjson --source b=b.ndjson --query \"SELECT a.id FROM a GLOSS { ip := a.client.ip | b.http.client_ip } WHERE CANON.ip = \\\"1.1.1.1\\\"\"",
      "input_files": [
        {
          "path": "b.ndjson",
          "content": [
            {
              "http": {
                "client_ip": "1.1.1.1"
              }
            }
          ],
          "file_type": "jsonl"
        },
        {
          "path": "a.ndjson",
          "content": [
            {
              "id": 1,
              "client": {
                "ip": "1.1.1.1"
              }
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "stderr": {
        "error": ".*E_SEMANTIC.*",
        "code": "E_SEMANTIC"
      },
      "status_code": 1
    }
  },
  "03_undeclared_canon": {
    "case": {
      "arguments": "--source a=a.ndjson --query \"SELECT CANON.user FROM a\"",
      "input_files": [
        {
          "path": "a.ndjson",
          "content": [
            {
              "id": 1
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "stderr": {
        "error": ".*E_SEMANTIC.*",
        "code": "E_SEMANTIC"
      },
      "status_code": 1
    }
  },
  "04_canon_wildcard_parse_error": {
    "case": {
      "arguments": "--source a=a.ndjson --query \"SELECT CANON.* FROM a GLOSS { x := a.id }\"",
      "input_files": [
        {
          "path": "a.ndjson",
          "content": [
            {
              "id": 1
            }
          ],
          "file_type": "jsonl"
        }
      ]
    },
    "expected": {
      "stderr": {
        "error": ".*E_PARSE.*",
        "code": "E_PARSE"
      },
      "status_code": 1
    }
  }
}