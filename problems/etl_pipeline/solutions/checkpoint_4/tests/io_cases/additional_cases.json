[
  {
    "name": "rename_mapping_multiple",
    "input": {
      "pipeline": {
        "steps": [
          {
            "op": " RENAME ",
            "mapping": {
              "first_name": "first",
              "last_name": "last"
            },
            "note": "ignored"
          }
        ]
      },
      "dataset": [
        {"first_name": "Anna", "last_name": "Smith"},
        {"first_name": "Bo", "last_name": "Lee"}
      ],
      "meta": {"version": 1}
    },
    "exit_code": 0,
    "output": {
      "status": "ok",
      "normalized": {
        "defs": {},
        "steps": [
          {
            "op": "rename",
            "mapping": {
              "first_name": "first",
              "last_name": "last"
            }
          }
        ]
      }
    }
  },
  {
    "name": "rename_conflicting_forms",
    "input": {
      "pipeline": {
        "steps": [
          {
            "op": "rename",
            "mapping": {"old": "new"},
            "from": "legacy"
          }
        ]
      },
      "dataset": []
    },
    "exit_code": 1,
    "output": {
      "status": "error",
      "error_code": "SCHEMA_VALIDATION_FAILED",
      "message": "ETL_ERROR: rename step must use either 'from'/'to' or 'mapping', not both",
      "path": "pipeline.steps[0]"
    }
  },
  {
    "name": "step_not_object",
    "input": {
      "pipeline": {"steps": ["oops"]},
      "dataset": []
    },
    "exit_code": 1,
    "output": {
      "status": "error",
      "error_code": "SCHEMA_VALIDATION_FAILED",
      "message": "ETL_ERROR: pipeline.steps[0] must be of type object",
      "path": "pipeline.steps[0]"
    }
  },
  {
    "name": "limit_boolean_disallowed",
    "input": {
      "pipeline": {"steps": [{"op": "limit", "n": true}]},
      "dataset": []
    },
    "exit_code": 1,
    "output": {
      "status": "error",
      "error_code": "SCHEMA_VALIDATION_FAILED",
      "message": "ETL_ERROR: limit.n must be an integer >= 0",
      "path": "pipeline.steps[0].n"
    }
  },
  {
    "name": "map_trim_and_limit_zero",
    "input": {
      "pipeline": {
        "steps": [
          {"op": "MAP", "as": " total ", "expr": " price*qty ", "note": 123},
          {"op": "limit", "n": 0}
        ]
      },
      "dataset": [{"ignored": true}],
      "comment": "keep"
    },
    "exit_code": 0,
    "output": {
      "status": "ok",
      "normalized": {
        "defs": {},
        "steps": [
          {"op": "map", "as": "total", "expr": "price*qty"},
          {"op": "limit", "n": 0}
        ]
      }
    }
  }
]
