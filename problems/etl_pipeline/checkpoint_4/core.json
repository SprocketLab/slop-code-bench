{
    "basic_call_and_select": {
        "stdin": {
            "defs": {
                "Normalize": {
                    "steps": [
                        {
                            "op": "map",
                            "as": "z",
                            "expr": "(value - params.mean) / params.std"
                        }
                    ]
                },
                "KeepCols": {
                    "steps": [
                        {
                            "op": "select",
                            "columns": [
                                "id",
                                "z"
                            ]
                        }
                    ]
                }
            },
            "pipeline": {
                "steps": [
                    {
                        "op": "call",
                        "name": "Normalize",
                        "params": {
                            "mean": 100,
                            "std": 20
                        }
                    },
                    {
                        "op": "call",
                        "name": "KeepCols",
                        "params": {}
                    }
                ]
            },
            "dataset": [
                {
                    "id": 1,
                    "value": 120
                },
                {
                    "id": 2,
                    "value": 80
                }
            ]
        },
        "expected": {
            "status": "ok",
            "data": [
                {
                    "id": 1,
                    "z": 1
                },
                {
                    "id": 2,
                    "z": -1
                }
            ],
            "metrics": {
                "rows_in": 2,
                "rows_out": 2
            }
        }
    },
    "chain_defs_params_literal": {
        "stdin": {
            "defs": {
                "Tag": {
                    "steps": [
                        {
                            "op": "map",
                            "as": "tag",
                            "expr": "params.label"
                        }
                    ]
                },
                "Keep": {
                    "steps": [
                        {
                            "op": "select",
                            "columns": [
                                "id",
                                "tag"
                            ]
                        }
                    ]
                }
            },
            "pipeline": {
                "steps": [
                    {
                        "op": "call",
                        "name": "Tag",
                        "params": {
                            "label": "A"
                        }
                    },
                    {
                        "op": "call",
                        "name": "Keep",
                        "params": {}
                    }
                ]
            },
            "dataset": [
                {
                    "id": 1
                },
                {
                    "id": 2
                }
            ]
        },
        "expected": {
            "status": "ok",
            "data": [
                {
                    "id": 1,
                    "tag": "A"
                },
                {
                    "id": 2,
                    "tag": "A"
                }
            ],
            "metrics": {
                "rows_in": 2,
                "rows_out": 2
            }
        }
    },
    "missing_param_null": {
        "stdin": {
            "defs": {
                "Z": {
                    "steps": [
                        {
                            "op": "map",
                            "as": "z",
                            "expr": "(value - params.mean) / params.std"
                        }
                    ]
                }
            },
            "pipeline": {
                "steps": [
                    {
                        "op": "call",
                        "name": "Z",
                        "params": {
                            "mean": 0
                        }
                    }
                ]
            },
            "dataset": [
                {
                    "id": 1,
                    "value": 5
                }
            ]
        },
        "expected": {
            "status": "ok",
            "data": [
                {
                    "id": 1,
                    "value": 5,
                    "z": null
                }
            ],
            "metrics": {
                "rows_in": 1,
                "rows_out": 1
            }
        }
    }
}
