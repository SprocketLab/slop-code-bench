arguments: migrate migration.json app.db
input_files:
- path: app.db
  file_type: sqlite
- content: "{\n  \"version\": 2,\n  \"description\": \"Complex employee data migration\"\
    ,\n  \"operations\": [\n    {\n      \"type\": \"add_column\",\n      \"table\"\
    : \"employees\",\n      \"column\": {\n        \"name\": \"email\",\n        \"\
    type\": \"TEXT\"\n      }\n    },\n    {\n      \"type\": \"add_column\",\n  \
    \    \"table\": \"employees\",\n      \"column\": {\n        \"name\": \"full_name\"\
    ,\n        \"type\": \"TEXT\"\n      }\n    },\n    {\n      \"type\": \"add_column\"\
    ,\n      \"table\": \"employees\",\n      \"column\": {\n        \"name\": \"\
    bonus\",\n        \"type\": \"INTEGER\"\n      }\n    },\n    {\n      \"type\"\
    : \"migrate_column_data\",\n      \"table\": \"employees\",\n      \"from_column\"\
    : \"temp_email\",\n      \"to_column\": \"email\",\n      \"default_value\": \"\
    'noemail@company.com'\"\n    },\n    {\n      \"type\": \"transform_data\",\n\
    \      \"table\": \"employees\",\n      \"transformations\": [\n        {\n  \
    \        \"column\": \"full_name\",\n          \"expression\": \"first_name ||\
    \ ' ' || last_name\"\n        },\n        {\n          \"column\": \"bonus\",\n\
    \          \"expression\": \"salary / 10\"\n        }\n      ]\n    },\n    {\n\
    \      \"type\": \"backfill_data\",\n      \"table\": \"employees\",\n      \"\
    column\": \"email\",\n      \"value\": \"LOWER(email)\"\n    }\n  ]\n}"
  file_type: json
  path: migration.json
tracked_files:
- app.db
expected_status: 0
