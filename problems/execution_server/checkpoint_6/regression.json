{
  "create_environment": {
    "expected": {
      "output": {
        "concurrency_mode": "never",
        "files": {
          "setup.txt": {
            "written_bytes": 15
          }
        },
        "name": "regression-env"
      },
      "status_code": 201
    },
    "input": {
      "body": {
        "concurrency_mode": "never",
        "files": {
          "setup.txt": "regression test"
        },
        "name": "regression-env"
      },
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "method": "POST",
      "path": "/v1/environment"
    },
    "order": 100
  },
  "stdin_execution": {
    "expected": {
      "output": {
        "cached": false,
        "duration": 10,
        "environment": {
          "committed": false,
          "name": "regression-env",
          "snapshot_source": "exclusive"
        },
        "exit_code": 0,
        "files": {},
        "id": "UUID",
        "stderr": "",
        "stdout": "line1\nline2\n",
        "timed_out": false
      },
      "status_code": 201
    },
    "input": {
      "body": {
        "command": "cat",
        "environment": "regression-env",
        "stdin": [
          "line1",
          "line2"
        ],
        "timeout": 10
      },
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "method": "POST",
      "path": "/v1/execute"
    },
    "order": 101
  },
  "csv_structured_file": {
    "expected": {
      "output": {
        "cached": false,
        "duration": 10,
        "environment": {
          "committed": false,
          "name": "regression-env",
          "snapshot_source": "exclusive"
        },
        "exit_code": 0,
        "files": {},
        "id": "UUID",
        "stderr": "",
        "stdout": "id,name\n1,alice\n2,bob\n",
        "timed_out": false
      },
      "status_code": 201
    },
    "input": {
      "body": {
        "command": "cat users.csv",
        "environment": "regression-env",
        "files": {
          "users.csv": [
            {
              "id": 1,
              "name": "alice"
            },
            {
              "id": 2,
              "name": "bob"
            }
          ]
        },
        "timeout": 10
      },
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "method": "POST",
      "path": "/v1/execute"
    },
    "order": 102
  },
  "track_glob_no_match": {
    "expected": {
      "output": {
        "cached": false,
        "duration": 10,
        "environment": {
          "committed": true,
          "name": "regression-env",
          "snapshot_source": "exclusive"
        },
        "exit_code": 0,
        "files": {},
        "id": "UUID",
        "stderr": "",
        "stdout": "",
        "timed_out": false
      },
      "status_code": 201
    },
    "input": {
      "body": {
        "command": "echo 'test' > output.txt",
        "environment": "regression-env",
        "timeout": 10,
        "track": [
          "*.nonexistent"
        ]
      },
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "method": "POST",
      "path": "/v1/execute"
    },
    "order": 103
  },
  "create_env_fork": {
    "order": 104,
    "input": {
      "method": "POST",
      "path": "/v1/environment",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "name": "regression-env-fork",
        "concurrency_mode": "fork",
        "files": {
          "base.txt": "fork env base"
        }
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "name": "regression-env-fork",
        "concurrency_mode": "fork",
        "files": {
          "base.txt": {
            "written_bytes": 13
          }
        }
      }
    }
  },
  "create_env_base": {
    "order": 105,
    "input": {
      "method": "POST",
      "path": "/v1/environment",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "name": "regression-env-base",
        "concurrency_mode": "base",
        "files": {
          "base.txt": "base env content"
        }
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "name": "regression-env-base",
        "concurrency_mode": "base",
        "files": {
          "base.txt": {
            "written_bytes": 16
          }
        }
      }
    }
  },
  "create_env_many_files": {
    "order": 106,
    "input": {
      "method": "POST",
      "path": "/v1/environment",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "name": "regression-env-many",
        "files": {
          "file1.txt": "content1",
          "file2.txt": "content2",
          "file3.txt": "content3",
          "file4.txt": "content4",
          "file5.txt": "content5",
          "file6.txt": "content6",
          "file7.txt": "content7",
          "file8.txt": "content8",
          "file9.txt": "content9",
          "file10.txt": "content10"
        }
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "name": "regression-env-many",
        "concurrency_mode": "never",
        "files": {
          "file1.txt": {
            "written_bytes": 8
          },
          "file2.txt": {
            "written_bytes": 8
          },
          "file3.txt": {
            "written_bytes": 8
          },
          "file4.txt": {
            "written_bytes": 8
          },
          "file5.txt": {
            "written_bytes": 8
          },
          "file6.txt": {
            "written_bytes": 8
          },
          "file7.txt": {
            "written_bytes": 8
          },
          "file8.txt": {
            "written_bytes": 8
          },
          "file9.txt": {
            "written_bytes": 8
          },
          "file10.txt": {
            "written_bytes": 9
          }
        }
      }
    }
  },
  "create_env_nested_dirs": {
    "order": 107,
    "input": {
      "method": "POST",
      "path": "/v1/environment",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "name": "regression-env-nested",
        "files": {
          "a/b/c/d/e/deep.txt": "deeply nested content"
        }
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "name": "regression-env-nested",
        "concurrency_mode": "never",
        "files": {
          "a/b/c/d/e/deep.txt": {
            "written_bytes": 21
          }
        }
      }
    }
  },
  "create_env_structured": {
    "order": 108,
    "input": {
      "method": "POST",
      "path": "/v1/environment",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "name": "regression-env-struct",
        "files": {
          "config.json": {
            "key": "value",
            "num": 42
          },
          "data.csv": [
            {
              "a": 1,
              "b": 2
            },
            {
              "a": 3,
              "b": 4
            }
          ],
          "records.jsonl": [
            {
              "id": 1
            },
            {
              "id": 2
            }
          ],
          "settings.yaml": {
            "setting": "enabled",
            "count": 10
          }
        }
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "name": "regression-env-struct",
        "concurrency_mode": "never",
        "files": {
          "config.json": {
            "written_bytes": 28
          },
          "data.csv": {
            "written_bytes": 12
          },
          "records.jsonl": {
            "written_bytes": 18
          },
          "settings.yaml": {
            "written_bytes": 27
          }
        }
      }
    }
  },
  "create_env_long_name": {
    "order": 109,
    "input": {
      "method": "POST",
      "path": "/v1/environment",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "name": "regression-environment-with-a-very-long-name-for-testing-purposes-12345",
        "files": {
          "test.txt": "long name env"
        }
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "name": "regression-environment-with-a-very-long-name-for-testing-purposes-12345",
        "concurrency_mode": "never",
        "files": {
          "test.txt": {
            "written_bytes": 13
          }
        }
      }
    }
  },
  "create_env_numeric_name": {
    "order": 110,
    "input": {
      "method": "POST",
      "path": "/v1/environment",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "name": "12345",
        "files": {
          "num.txt": "numeric name"
        }
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "name": "12345",
        "concurrency_mode": "never",
        "files": {
          "num.txt": {
            "written_bytes": 12
          }
        }
      }
    }
  },
  "env_stdin_shell_injection": {
    "order": 111,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat",
        "environment": "regression-env",
        "stdin": [
          "$(whoami)",
          "; rm -rf /",
          "| cat /etc/passwd"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "$(whoami)\n; rm -rf /\n| cat /etc/passwd\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_stdin_unicode": {
    "order": 112,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat",
        "environment": "regression-env",
        "stdin": [
          "\ud83d\udd25",
          "\u041f\u0440\u0438\u0432\u0435\u0442",
          "\u65e5\u672c\u8a9e"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "\ud83d\udd25\n\u041f\u0440\u0438\u0432\u0435\u0442\n\u65e5\u672c\u8a9e\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_stdin_long": {
    "order": 113,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "wc -c",
        "environment": "regression-env",
        "stdin": [
          "CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "3413\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_stdin_empty_string": {
    "order": 114,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "echo env_empty_stdin",
        "environment": "regression-env",
        "stdin": "",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "env_empty_stdin\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_chain_basic": {
    "order": 115,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": [
          {
            "cmd": "echo chain_in_env_step1"
          },
          {
            "cmd": "echo chain_in_env_step2"
          }
        ],
        "environment": "regression-env",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "commands": [
          {
            "cmd": "echo chain_in_env_step1",
            "stdout": "chain_in_env_step1\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "echo chain_in_env_step2",
            "stdout": "chain_in_env_step2\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          }
        ],
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_chain_with_required": {
    "order": 116,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": [
          {
            "cmd": "echo env_req_step1"
          },
          {
            "cmd": "sh -c 'exit 1'"
          },
          {
            "cmd": "echo env_req_cleanup",
            "required": true
          }
        ],
        "environment": "regression-env",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "commands": [
          {
            "cmd": "echo env_req_step1",
            "stdout": "env_req_step1\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "sh -c 'exit 1'",
            "stdout": "",
            "stderr": "",
            "exit_code": 1,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "echo env_req_cleanup",
            "stdout": "env_req_cleanup\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false,
            "required": true
          }
        ],
        "exit_code": 1,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_chain_file_tracking": {
    "order": 117,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": [
          {
            "cmd": "echo step1 > chain_output.txt"
          },
          {
            "cmd": "echo step2 >> chain_output.txt"
          }
        ],
        "environment": "regression-env",
        "track": [
          "*.txt"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "commands": [
          {
            "cmd": "echo step1 > chain_output.txt",
            "stdout": "",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "echo step2 >> chain_output.txt",
            "stdout": "",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          }
        ],
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {
          "setup.txt": "regression test",
          "output.txt": "test\n",
          "chain_output.txt": "step1\nstep2\n"
        },
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": true
        }
      }
    }
  },
  "env_chain_timeout": {
    "order": 118,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": [
          {
            "cmd": "echo before_timeout"
          },
          {
            "cmd": "sleep 5",
            "timeout": 0.3
          },
          {
            "cmd": "echo after_timeout",
            "required": true
          }
        ],
        "environment": "regression-env",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "commands": [
          {
            "cmd": "echo before_timeout",
            "stdout": "before_timeout\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "sleep 5",
            "stdout": "",
            "stderr": "",
            "exit_code": -1,
            "duration": 0.5,
            "timed_out": true
          },
          {
            "cmd": "echo after_timeout",
            "stdout": "after_timeout\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false,
            "required": true
          }
        ],
        "exit_code": -1,
        "duration": 10,
        "timed_out": true,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_overlay_basic": {
    "order": 119,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat extra.txt",
        "environment": "regression-env",
        "files": {
          "extra.txt": "overlay content"
        },
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "overlay content",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_overlay_overwrite": {
    "order": 120,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat setup.txt",
        "environment": "regression-env",
        "files": {
          "setup.txt": "overwritten content"
        },
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "overwritten content",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_overlay_plus_stdin": {
    "order": 121,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat config.txt && cat",
        "environment": "regression-env",
        "files": {
          "config.txt": "config=value"
        },
        "stdin": [
          "stdin line"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "config=valuestdin line\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_overlay_structured": {
    "order": 122,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat overlay.json",
        "environment": "regression-env",
        "files": {
          "overlay.json": {
            "structured": true,
            "value": 42
          }
        },
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "{\"structured\":true,\"value\":42}",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_overlay_nested_path": {
    "order": 123,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat new/nested/path.txt",
        "environment": "regression-env",
        "files": {
          "new/nested/path.txt": "nested overlay"
        },
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "nested overlay",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_fork_stdin": {
    "order": 124,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat",
        "environment": "regression-env-fork",
        "stdin": [
          "fork mode stdin"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "fork mode stdin\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env-fork",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_base_stdin": {
    "order": 125,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat",
        "environment": "regression-env-base",
        "stdin": [
          "base mode stdin"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "base mode stdin\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env-base",
          "snapshot_source": "base",
          "committed": false
        }
      }
    }
  },
  "env_kitchen_sink": {
    "order": 126,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": [
          {
            "cmd": "cat config.json"
          },
          {
            "cmd": "cat"
          },
          {
            "cmd": "echo final > result.txt",
            "required": true
          }
        ],
        "environment": "regression-env",
        "files": {
          "config.json": {
            "kitchen": "sink"
          }
        },
        "stdin": [
          "stdin data"
        ],
        "track": [
          "*.txt"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "commands": [
          {
            "cmd": "cat config.json",
            "stdout": "{\"kitchen\":\"sink\"}",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "cat",
            "stdout": "stdin data\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "echo final > result.txt",
            "stdout": "",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false,
            "required": true
          }
        ],
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {
          "setup.txt": "overwritten content",
          "output.txt": "test\n",
          "chain_output.txt": "step1\nstep2\n",
          "extra.txt": "overlay content",
          "config.txt": "config=value",
          "new/nested/path.txt": "nested overlay",
          "result.txt": "final\n"
        },
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": true
        }
      }
    }
  },
  "env_cache_setup": {
    "order": 127,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "echo env_cache_unique_77777",
        "environment": "regression-env",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "env_cache_unique_77777\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_cache_hit": {
    "order": 128,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "echo env_cache_unique_77777",
        "environment": "regression-env",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "env_cache_unique_77777\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": true,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_cache_stdin_miss": {
    "order": 129,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat",
        "environment": "regression-env",
        "stdin": [
          "different_stdin_for_cache_miss"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "different_stdin_for_cache_miss\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_whitespace_stdin": {
    "order": 130,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat",
        "environment": "regression-env",
        "stdin": [
          "  ",
          "\t",
          "  \t  "
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "  \n\t\n  \t  \n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_empty_overlay": {
    "order": 131,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "echo empty_overlay_test",
        "environment": "regression-env",
        "files": {},
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "empty_overlay_test\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_nested_read": {
    "order": 132,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat a/b/c/d/e/deep.txt",
        "environment": "regression-env-nested",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "deeply nested content",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env-nested",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_stdin_quotes_escapes": {
    "order": 133,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "cat",
        "environment": "regression-env",
        "stdin": [
          "he said \"hello\"",
          "it's fine",
          "back\\slash"
        ],
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "he said \"hello\"\nit's fine\nback\\slash\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_chain_continue_on_error": {
    "order": 134,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": [
          {
            "cmd": "sh -c 'exit 1'"
          },
          {
            "cmd": "echo continue_env_test"
          }
        ],
        "environment": "regression-env",
        "continue_on_error": true,
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "commands": [
          {
            "cmd": "sh -c 'exit 1'",
            "stdout": "",
            "stderr": "",
            "exit_code": 1,
            "duration": 10,
            "timed_out": false
          },
          {
            "cmd": "echo continue_env_test",
            "stdout": "continue_env_test\n",
            "stderr": "",
            "exit_code": 0,
            "duration": 10,
            "timed_out": false
          }
        ],
        "exit_code": 1,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  },
  "env_many_files_count": {
    "order": 135,
    "input": {
      "method": "POST",
      "path": "/v1/execute",
      "headers": {
        "content-type": "application/json; charset=utf-8"
      },
      "body": {
        "command": "ls -1 | wc -l",
        "environment": "regression-env-many",
        "timeout": 10
      }
    },
    "expected": {
      "status_code": 201,
      "output": {
        "id": "UUID",
        "stdout": "10\n",
        "stderr": "",
        "exit_code": 0,
        "duration": 10,
        "timed_out": false,
        "files": {},
        "cached": false,
        "environment": {
          "name": "regression-env-many",
          "snapshot_source": "exclusive",
          "committed": false
        }
      }
    }
  }
}