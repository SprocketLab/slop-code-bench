case:
  body:
    metrics:
      pass: true
      score: 0.92
  headers:
    content-type: application/json; charset=utf-8
    if-match: W/"3"
  id: finalize_with_updated_metrics
  method: POST
  path: /trajectories/{{store.create_in_progress_trajectory}}/finalize
expected:
  output:
    properties:
      id:
        const: "{{store.create_in_progress_trajectory}}"
      status:
        const: finalized
      rev:
        const: 4
      steps:
        const: 6
      final_output_tokens:
        const: 25
      final_cost:
        const: 0.0032
      metrics:
        properties:
          pass:
            const: true
          score:
            const: 0.92
        type: object
      finalized_at:
        type: string
        pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$'
    required:
    - id
    - status
    - rev
    - steps
    - final_output_tokens
    - final_cost
    - metrics
    - finalized_at
    type: object
  status_code: 200